<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ì™„ë²½ì— ëŒ€í•œ ì˜ë¢°</title>
<style>
:root {
  --accent: #ff4d9e;    /* ê°•í•œ ë„¤ì˜¨í•‘í¬ */
  --accent2: #9eb7ff;   /* ë¶€ë“œëŸ¬ìš´ ë„¤ì˜¨ë¸”ë£¨ */
  --bg: #000000;         /* ë°°ê²½ì€ ê·¸ëŒ€ë¡œ ê²€ì • */
  --text: #d1d9e8;      /* ì—°í•œ íšŒìƒ‰ */
}

html, body { height: 100%; margin: 0; }
body {
  background: var(--bg) url('background.jpg') no-repeat center center fixed;
  background-size: cover;
  color: var(--text);
  font-family: Pretendard, sans-serif;
  overflow: hidden;
  position: relative;
}

#overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background-color: rgba(0,0,0,0.75); /* ì²« ì½”ë“œì™€ ë™ì¼ */
  z-index: 1;
  pointer-events: none;
}

.game-intro { 
  top: 50px; 
  text-align: center; 
  font-size: 1rem; 
  color: #ff85b3; 
  opacity: 0.9; 
  margin-top: 20px; 
  margin-bottom: -5px; 
  letter-spacing: 0.03em; 
  text-shadow: 0 0 6px rgba(255,130,179,0.3); 
  z-index: 10; 
  position: relative; 
}

h1 { 
  text-align: center; 
  top: 110px; 
  margin: 10px 0 5px; 
  color: #ff4d9e; 
  font-size: 1.2rem; 
  font-weight: 600; 
  position: relative; 
  z-index: 10; 
  pointer-events: none; 
  text-shadow: 0 0 10px rgba(255,77,158,0.6); 
}


#game-area { 
  position: relative; 
  top: 50px;
  width: 100vw; 
  height: calc(80vh - 40px); 
  overflow: hidden; 
  z-index: 5;
}

canvas#wordCanvas {
  position: absolute;
  left: 0;
  top: 0px;
  width: 100%;
  height: 100%;
  z-index: 10;
  pointer-events: auto;
  background: transparent;
}

canvas#particleCanvas, canvas#burstCanvas { 
  position: fixed; 
  left:0; top:0; 
  pointer-events: none; 
}

canvas#particleCanvas { z-index: 8; }
canvas#burstCanvas { z-index: 9; }

#ability-inventory { 
  position: fixed; 
  right: 100px; 
  top: 80px; 
  width: 150px; 
  padding: 10px; 
  background: rgba(0,0,0,0.45); 
  border-radius: 5px; 
  color: var(--text); 
  z-index: 10; 
}

#ability-inventory h2 {
  font-size: 1rem; 
  text-align: center; 
  margin:0 0 10px 0; 
  color:#ff85b3; 
}

#inventory-list { 
  display:flex; 
  flex-direction: column; 
  gap:10px; 
}

.inventory-item { 
  font-size:0.85rem; 
  padding:4px 8px; 
  background:#2f3e52; 
  color:#d1d9e8; 
  border-radius:3px; 
  text-align:center; 
  border:0px solid #3f5065; 
  opacity:1; 
}

#game-record { 
  position: fixed; 
  left: 100px; 
  top: 80px; 
  width: 200px; 
  padding: 10px; 
  background: rgba(0,0,0,0.45); 
  border-radius: 5px; 
  color: var(--text); 
  z-index: 10; 
}

#game-record h2 { 
  font-size: 1rem; 
  text-align: center; 
  margin: 0 0 5px 0; 
  color: #ff85b3; 
}

#record-stats div, #record-log div { 
  font-size: 0.85rem; 
  padding:4px 8px; 
  background:#2f3e52; 
  color:#d1d9e8; 
  border-radius:3px; 
  text-align:center; 
  margin-bottom:4px; 
}

#round-timer {
  position: fixed;
  top: 17.5%;
  right: 847px;
  transform: translateY(20%);
  font-size: 1.2rem;
  color: #ff85b3;        /* ì´ˆ íƒ€ì´ë¨¸ ìƒ‰ìƒ */
  z-index: 20;
  text-shadow: 0 0 6px rgba(255,130,179,0.5); /* ê¸€ë¡œìš° */
  pointer-events: none;
}


</style>

</head>
<body>
<audio id="bgm" src="bad.mp3" loop></audio>


<div id="overlay"></div>

<canvas id="particleCanvas"></canvas>
<canvas id="burstCanvas"></canvas>

<div class="game-intro"></div>
<h1 id="target-word">?</h1>
<div id="game-area"></div>

<div id="ability-inventory">
  <h2>íšë“í•œ ëŠ¥ë ¥</h2>
  <div id="inventory-list"></div>
  <div id="hint-area" style="text-align:center; margin-top:15px;">
  <button id="btn-hint" style="width:100%; padding:8px; margin-bottom:8px; background:#ff85b3; color:#fff; border:none; border-radius:4px; cursor:pointer; font-weight:600;">ì •ë‹µ</button>
  <button id="btn-tip" style="width:100%; padding:8px; background:#ff85b3; color:#fff; border:none; border-radius:4px; cursor:pointer; font-weight:600;">íŒíŠ¸</button>
  <div id="tip-message" style="margin-top:10px; color:#ff66cc; font-weight:400; font-size: 13px"></div>
</div>


</div>

</div>

<div id="game-record">
  <h2>ê²Œì„ ê¸°ë¡</h2>
  <div id="record-stats">
    <div>ì„±ê³µ: <span id="win-count">0</span></div>
    <div>ì‹¤íŒ¨: <span id="lose-count">0</span></div>
  </div>
  <h2>-</h2>
  <h2>ìµœê·¼ ê¸°ë¡</h2>
  <div id="record-log"></div>
</div>

<div id="round-timer">10</div>



<script>

// ğŸ”« ì •ë‹µ íš¨ê³¼ìŒ
const gunSound = new Audio('gun.mp3');
gunSound.volume = 0.8;
gunSound.preload = 'auto';


  let totalGameTime = 60; // 30ì´ˆ
const totalTimerEl = document.createElement('div');
totalTimerEl.id = 'total-game-timer';
totalTimerEl.style.position = 'fixed';
totalTimerEl.style.top = '50px';
totalTimerEl.style.left = '50%';
totalTimerEl.style.transform = 'translateX(-50%)';
totalTimerEl.style.color = '#ff85b3';
totalTimerEl.style.fontSize = '2.5rem';
totalTimerEl.style.zIndex = '9999';
totalTimerEl.style.pointerEvents = 'none';
totalTimerEl.textContent = totalGameTime;
document.body.appendChild(totalTimerEl);

const totalGameInterval = setInterval(()=>{
  totalGameTime--;
  totalTimerEl.textContent = totalGameTime;
  if(totalGameTime <= 0){
    clearInterval(totalGameInterval);
    alert('ì´ ê²Œì„ ì‹œê°„ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
    window.location.href = "result.html";
  }
}, 1000);
// ===== ë°ì´í„°(ì›ë³¸ê³¼ ë™ì¼) =====
const abilities = ["ìš©ê¸°","ì§€í˜œ","ì—´ì •","ì°½ì˜ë ¥","ì¸ë‚´"];
const distractors = [
  "ìš•ì‹¬","ê²°ë‹¨","ê°ì •","ì„±ì‹¤","í¬ë§","ëª…ì˜ˆ","ì‹ ë…","ë°°ë ¤","í˜¸ê¸°ì‹¬","í—Œì‹ ",
  "ìœ í˜¹","ì±…ì„","ê´€ìš©","ì ˆì œ","ê´€ì°°","ê·¼ì„±","ì •ì˜","ì˜ì‹¬","ì—´ë§","ì‹ ì¤‘",
  "ê²¸ì†","ì‚¬ë‘","ë‘ë ¤ì›€","ê´€ì‹¬","ìì¡´ì‹¬","ë„ì „ì •ì‹ ","í¬ìƒ","ê¸ì •","ì˜ì§€",
  "ëƒ‰ì •","í†µì°°","ì—°ë¯¼","ìƒìƒ","ì°½ì¡°","ëª°ì…","ëˆê¸°","ì—´ì •","ì§‘ì¤‘ë ¥",
  "í¬ìš©","ë„ë•","ì •ì§","ì‚¬ê³ ë ¥","ì†Œí†µ","ê³µê°","ì¶”ì§„ë ¥","ì§€í˜œ","ì°½ì˜ë ¥",
  "ìš©ê¸°","ì¸ë‚´","ê· í˜•","ìœ ì—°í•¨","ì±…ì„ê°","í—Œì‹ ","ë°°ë ¤ì‹¬","ë„ì „","ê²°ë‹¨ë ¥"
];
const colors = ["#2f3e52","#3f5065","#4e627a","#5d7390"];
let inventoryStatus = Array(abilities.length).fill(false);

const targetEl = document.getElementById('target-word');
const area = document.getElementById('game-area');
const burstCanvas = document.getElementById('burstCanvas');
const burstCtx = burstCanvas.getContext('2d');
const timerEl = document.getElementById('round-timer');

let currentTarget = "";
let roundTimer = null;
let countdownInterval = null;

// ===== ì¸ë²¤í† ë¦¬ (ì›ë³¸ê³¼ ë™ì¼) =====
function initInventory() {
  const list = document.getElementById('inventory-list');
  list.innerHTML = "";
  abilities.forEach(() => {
    const item = document.createElement('div');
    item.className = 'inventory-item';
    item.textContent = "-";
    list.appendChild(item);
  });
}
initInventory();

function addToInventory(word) {
  const index = abilities.indexOf(word);
  if (index === -1 || inventoryStatus[index]) return;

  inventoryStatus[index] = true;
  document.getElementById('inventory-list').children[index].textContent = word;
}



const recordLog = document.getElementById('record-log');
function addRecordLog(msg) {
  const div=document.createElement('div');
  div.textContent=msg;
  recordLog.prepend(div);
  if(recordLog.children.length>5) recordLog.removeChild(recordLog.lastChild);
}

// ===== í­ë°œ (ì›ë³¸ ë²„ìŠ¤íŠ¸) =====
function resizeBurstCanvas() { burstCanvas.width = window.innerWidth; burstCanvas.height = window.innerHeight; }
resizeBurstCanvas(); window.addEventListener('resize',resizeBurstCanvas);
function burstEffect(x,y){
  const particles=[];
  for(let i=0;i<40;i++){
    particles.push({ x,y, vx:(Math.random()-0.5)*6, vy:(Math.random()-0.5)*6, life:30+Math.random()*20, size:2+Math.random()*2, color: colors[Math.floor(Math.random()*colors.length)] });
  }
  const animate=()=>{
    burstCtx.clearRect(0,0,burstCanvas.width,burstCanvas.height);
    particles.forEach(p=>{
      p.x+=p.vx; p.y+=p.vy; p.vx*=0.95; p.vy*=0.95; p.life--;
      const alpha=p.life/50;
      burstCtx.beginPath(); burstCtx.fillStyle=p.color; burstCtx.globalAlpha=Math.max(0,alpha);
      burstCtx.arc(p.x,p.y,p.size,0,Math.PI*2); burstCtx.fill();
      burstCtx.globalAlpha=1;
    });
    if(particles.some(p=>p.life>0)) requestAnimationFrame(animate);
  }
  animate();
}

// ===== ìº”ë²„ìŠ¤ ì¤€ë¹„ (ìˆ˜ì •ëœ ë¶€ë¶„) =====
const wordCanvas = document.createElement('canvas');
wordCanvas.id = 'wordCanvas';
wordCanvas.style.position = 'absolute';
wordCanvas.style.left = '0';
wordCanvas.style.top = '0';
wordCanvas.style.width = '100%';
wordCanvas.style.height = '100%';
wordCanvas.style.pointerEvents = 'auto';
area.appendChild(wordCanvas);

const wCtx = wordCanvas.getContext('2d');

// particleCanvas ì¤€ë¹„
let pCtx;
let particleCanvas = document.getElementById('particleCanvas');
if(!particleCanvas){
  particleCanvas = document.createElement('canvas');
  particleCanvas.id = 'particleCanvas';
  particleCanvas.style.position = 'fixed';
  particleCanvas.style.left = '0';
  particleCanvas.style.top = '0';
  particleCanvas.style.pointerEvents = 'none';
  particleCanvas.style.zIndex = 8;
  document.body.appendChild(particleCanvas);
}
pCtx = particleCanvas.getContext('2d');

// ìº”ë²„ìŠ¤ ë¦¬ì‚¬ì´ì¦ˆ: **wordCanvas í¬ê¸°ë¥¼ game-area (ì‹¤ì œ ì˜ì—­) ì‚¬ì´ì¦ˆë¡œ ë§ì¶¤**
function resizeCanvases(){
  const rect = area.getBoundingClientRect();
  // wordCanvasì˜ ë‚´ë¶€ í”½ì…€ í¬ê¸°ë¥¼ game-areaì™€ ì •í™•íˆ ë§ì¶˜ë‹¤
  wordCanvas.width = rect.width;
  wordCanvas.height = rect.height;
  wordCanvas.style.left = rect.left + 'px';
  wordCanvas.style.top = rect.top + 'px';
  // particle/burst full window
  particleCanvas.width = window.innerWidth;
  particleCanvas.height = window.innerHeight;
  resizeBurstCanvas();
}
resizeCanvases();
window.addEventListener('resize', resizeCanvases);

// ===== íŒŒí‹°í´ (ì›ë³¸ê³¼ ë™ì¼) =====
let particles=[];
document.addEventListener('mousemove',e=>{
  for(let i=0;i<2;i++) particles.push({x:e.clientX,y:e.clientY,vx:(Math.random()-0.5)*1.2,vy:(Math.random()-0.5)*1.2,life:25+Math.random()*10,size:1+Math.random()*1.8});
});
function drawParticles(){
  if(!pCtx) return;
  pCtx.clearRect(0,0,particleCanvas.width, particleCanvas.height);
  for(let i=particles.length-1;i>=0;i--){
    const p=particles[i]; p.x+=p.vx; p.y+=p.vy; p.life--;
    const alpha=Math.max(0,p.life/25);
   pCtx.beginPath(); 
pCtx.fillStyle=`rgba(255,102,204,${alpha})`; // í•‘í¬ìƒ‰
pCtx.arc(p.x,p.y,p.size,0,Math.PI*2); 
pCtx.fill();

    if(p.life<=0) particles.splice(i,1);
  }
  requestAnimationFrame(drawParticles);
}
drawParticles();

// ===== ë‹¨ì–´ ë°ì´í„° ë° ë Œë”/íšŒì „ ë£¨í”„ (canvas) =====
let wordObjects = []; // { text, x, y, z, isTarget, color, removed, screenX, screenY, radius }
let angleY = 0;

// spawnWordsToCanvas: ìº”ë²„ìŠ¤ì˜ ì‹¤ì œ í”½ì…€ í¬ê¸°(wordCanvas.width/height)ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ìœ„ì¹˜ ê³„ì‚°
function spawnWordsToCanvas(targetWord, count=1){
 const radiusX = Math.min(wordCanvas.width, wordCanvas.height) * 0.42;
const radiusY = Math.min(wordCanvas.width, wordCanvas.height) * 0.36;


  const allWords = [];
  for(let i=0;i<count;i++) allWords.push(distractors[Math.floor(Math.random()*distractors.length)]);
  allWords.push(targetWord);

  allWords.forEach(wordText => {
    const phi=Math.random()*Math.PI;
    const theta=Math.random()*2*Math.PI;
    const x = radiusX*Math.sin(phi)*Math.cos(theta);
    const y = radiusY*Math.sin(phi)*Math.sin(theta);
    const z = radiusY*Math.cos(phi);
    const color = colors[Math.floor(Math.random()*colors.length)];
    wordObjects.push({
      text: wordText,
      x, y, z,
      isTarget: wordText === targetWord,
      color,
      removed: false,
      screenX:0, screenY:0, radius:20,
      // ì¶”ê°€ëœ íˆíŠ¸ë°•ìŠ¤ ê¸°ë³¸ê°’(ë‚˜ì¤‘ì— ë Œë”ì—ì„œ ê³„ì‚°)
      width: 0, height: 0, hitX: 0, hitY: 0
    });
  });
}

// draw loop: **wordCanvasì˜ width/heightë¥¼ ì‚¬ìš©í•´ì„œ** ì¤‘ì‹¬ê³¼ ë°˜ì§€ë¦„ ê³„ì‚°
function drawWordsLoop() {
  const cx = wordCanvas.width / 2;
  const cy = wordCanvas.height / 2;
  const radiusY = Math.min(wordCanvas.width, wordCanvas.height) * 0.30;

  wCtx.clearRect(0, 0, wordCanvas.width, wordCanvas.height);

  angleY -= 0.0025; // íšŒì „ ì†ë„

  // z(ê¹Šì´) ê¸°ì¤€ ì •ë ¬
  const sorted = wordObjects.slice().sort((a, b) => {
  if (a.isTarget && !b.isTarget) return 1;   // ì •ë‹µ ë‹¨ì–´ë¥¼ í•­ìƒ ë§¨ ìœ„ë¡œ
  if (!a.isTarget && b.isTarget) return -1;  
  return (b.z - a.z);  // ì•„ë‹ˆë©´ ê¸°ì¡´ ê¹Šì´ ì •ë ¬
});

  for (const w of sorted) {
    if (w.removed) continue;

    // 3D Yì¶• íšŒì „
    const x = w.x * Math.cos(angleY) - w.z * Math.sin(angleY);
    const z = w.x * Math.sin(angleY) + w.z * Math.cos(angleY);

    const scale = (z + radiusY) / (2 * radiusY) + 0.5; // 0.5~1.5
    const fontSize = Math.round(16 * scale) + (w.isTarget ? 3 : 0);

    wCtx.font = `${fontSize}px Pretendard, sans-serif`;
    wCtx.textAlign = 'center';
    wCtx.textBaseline = 'middle';

    const normalColor = `rgba(200,210,220,${0.6 + 0.4 * Math.min(1, scale)})`;
    const targetColor = 'rgba(255,182,193,0.8)';

    wCtx.fillStyle = w.isTarget ? targetColor : normalColor;

    wCtx.globalAlpha = 1;
    wCtx.shadowColor = w.isTarget ? "rgba(158,183,255,0.6)" : "rgba(0,0,0,0.15)";
    wCtx.shadowBlur = w.isTarget ? 8 : 1;

    // ì¤‘ì•™ ê¸°ì¤€ ì¢Œí‘œ ê³„ì‚°
    let sx = cx + x * scale - 20;
    let sy = cy + w.y * scale;

    // â˜… ë‹¨ì–´ê°€ í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°€ì§€ ì•Šë„ë¡ clamp
    const padding = fontSize / 2;
    sx = Math.min(Math.max(sx, padding), wordCanvas.width - padding);
    sy = Math.min(Math.max(sy, padding), wordCanvas.height - padding);

    wCtx.fillText(w.text, sx, sy);

    // --- ì—¬ê¸°ì„œ íˆíŠ¸ë°•ìŠ¤(ì‚¬ê°í˜•) ê³„ì‚° ì¶”ê°€ (ë³´ì´ì§€ ì•ŠìŒ) ---
    const metrics = wCtx.measureText(w.text);
    const textWidth = metrics.width;
    const textHeight = fontSize * 1.0; // ëŒ€ëµ í…ìŠ¤íŠ¸ ë†’ì´(í°íŠ¸ë³„ ì˜¤ì°¨ ì¡´ì¬)
    // íˆíŠ¸ ë°•ìŠ¤ì— ì—¬ìœ (padding)ë¥¼ ì•½ê°„ ì¤Œ
    const padX = 10;
    const padY = 6;
    w.width = textWidth + padX * 2;
    w.height = textHeight + padY * 2;
    // hitX, hitY ëŠ” ìº”ë²„ìŠ¤ ë¡œì»¬ ì¢Œí‘œ ê¸°ì¤€
    w.hitX = sx - (w.width / 2);
    w.hitY = sy - (w.height / 2);

    // ìƒí˜¸ì‘ìš© ì¢Œí‘œ ì €ì¥ (ê¸°ì¡´ ì½”ë“œì™€ í˜¸í™˜ ìœ ì§€)
    w.screenX = sx;
    w.screenY = sy;
    w.radius = Math.max(16, fontSize * 0.8);

    wCtx.shadowBlur = 0;
  }

  requestAnimationFrame(drawWordsLoop);
}

drawWordsLoop();

// ===== í´ë¦­ íŒì •: ìº”ë²„ìŠ¤ í´ë¦­ ì´ë²¤íŠ¸ì—ì„œ í´ë¼ì´ì–¸íŠ¸ ì¢Œí‘œë¥¼ ìº”ë²„ìŠ¤ ë¡œì»¬ ì¢Œí‘œë¡œ ë³€í™˜í•˜ì—¬ íŒì • =====
wordCanvas.addEventListener('click', (e) => {
  // ìº”ë²„ìŠ¤ì˜ í™”ë©´ ë‚´ ìœ„ì¹˜ ì •ë³´
  const rect = wordCanvas.getBoundingClientRect();
  const mx = e.clientX - rect.left; // ìº”ë²„ìŠ¤ ë¡œì»¬ X
  const my = e.clientY - rect.top;  // ìº”ë²„ìŠ¤ ë¡œì»¬ Y

  // ì•ì—(ê¹Šì´ í°) ë‹¨ì–´ ìš°ì„  íƒìƒ‰
  const sorted = wordObjects.slice().sort((a,b) => (b.z - a.z));
  let hit = null;
  for(const w of sorted){
    if(w.removed) continue;

    // === ì›í˜• ê±°ë¦¬ íŒì • ëŒ€ì‹ , ë³´ì´ì§€ ì•ŠëŠ” íˆíŠ¸ë°•ìŠ¤(rect) íŒì • ì‚¬ìš© ===
    if (
      mx >= w.hitX &&
      mx <= w.hitX + w.width &&
      my >= w.hitY &&
      my <= w.hitY + w.height
    ) {
      hit = w;
      break;
    }
  }

  if(hit){
    if(hit.text === currentTarget){
      // ğŸ”« ì •ë‹µ íš¨ê³¼ìŒ (ì• 2ì´ˆ ìŠ¤í‚µ)
gunSound.currentTime = 2.5;
gunSound.play();


      // ì •ë‹µ ì²˜ë¦¬: ì›ë³¸ ì½”ë“œì™€ ë™ì¼í•˜ê²Œ ë™ì‘í•˜ë„ë¡ ìœ ì§€
      hit.removed = true;
      // burstEffectëŠ” í™”ë©´(client) ì¢Œí‘œë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ ê·¸ëŒ€ë¡œ e.clientX/Y ì „ë‹¬
      burstEffect(e.clientX, e.clientY);
      addToInventory(currentTarget);
      document.getElementById('win-count').textContent = parseInt(document.getElementById('win-count').textContent)+1;
      addRecordLog(`${currentTarget} ì„ íƒ`);
      clearTimeout(roundTimer);
      clearInterval(countdownInterval);
      setTimeout(()=>startNextRound(),1500);
    } else {
      // ì˜¤ë‹µ í´ë¦­: ì›ë³¸ê³¼ ë™ì¼
      const loseCountEl=document.getElementById('lose-count');
      loseCountEl.textContent=parseInt(loseCountEl.textContent)+1;
      addRecordLog(`ì˜¤ë‹µ: ${hit.text} í´ë¦­`);
      burstEffect(e.clientX, e.clientY);
    }
  } else {
    // ë¹ˆ ê³µê°„ í´ë¦­: ì›ë³¸ê³¼ ë™ì¼
    const loseCountEl=document.getElementById('lose-count');
    loseCountEl.textContent=parseInt(loseCountEl.textContent)+1;
    addRecordLog(`ë¹ˆ ê³µê°„ í´ë¦­`);
  }
});
function addToInventory(word) {
  const index = abilities.indexOf(word);
  if (index === -1 || inventoryStatus[index]) return;

  inventoryStatus[index] = true;
  document.getElementById('inventory-list').children[index].textContent = word;

  // --- ëª¨ë“  ëŠ¥ë ¥ íšë“ ì‹œ ê²°ê³¼ ì €ì¥ + í˜ì´ì§€ ì´ë™ ---
  if (inventoryStatus.every(v => v === true)) {

    const winCount = document.getElementById('win-count').textContent;
    const loseCount = document.getElementById('lose-count').textContent;

    const logs = Array.from(document.getElementById("record-log").children)
                      .map(el => el.textContent);

    localStorage.setItem("gameResult", JSON.stringify({
        wins: winCount,
        losses: loseCount,
        abilities: abilities,
        log: logs
    }));

    // --- ìƒˆ ì½”ë“œ ì‹œì‘: ì „ì²´í™”ë©´ ì˜¤ë²„ë ˆì´ ë©”ì‹œì§€ ---
    const overlayMsg = document.createElement('div');
    overlayMsg.id = 'all-abilities-overlay';
    overlayMsg.style.position = 'fixed';
    overlayMsg.style.top = '0';
    overlayMsg.style.left = '0';
    overlayMsg.style.width = '100vw';
    overlayMsg.style.height = '100vh';
    overlayMsg.style.backgroundColor = 'rgba(0,0,0,0.5)';
    overlayMsg.style.display = 'flex';
    overlayMsg.style.justifyContent = 'center';
    overlayMsg.style.alignItems = 'center';
    overlayMsg.style.color = '#fff';
    overlayMsg.style.fontSize = '1.5rem';
    overlayMsg.style.zIndex = '9999';
    overlayMsg.style.pointerEvents = 'none';
    overlayMsg.textContent = 'ëŠ¥ë ¥ì„ ëª¨ë‘ íšë“í–ˆìŠµë‹ˆë‹¤';
    document.body.appendChild(overlayMsg);
    // --- ìƒˆ ì½”ë“œ ë ---

    setTimeout(() => {
      window.location.href = "result.html";
    }, 3000);
  }
}




// ===== ë¼ìš´ë“œ ì œì–´ (ì›ë³¸ê³¼ ë™ì¼ ë¡œì§ ìœ ì§€) =====
let remainingTargets=[...abilities];

function startNextRound(){
  if(roundTimer) clearTimeout(roundTimer);
  if(countdownInterval) clearInterval(countdownInterval);

  if(remainingTargets.length===0) remainingTargets=[...abilities];
  const idx=Math.floor(Math.random()*remainingTargets.length);
  currentTarget=remainingTargets[idx];
  remainingTargets.splice(idx,1);

  targetEl.textContent=currentTarget;

  // ìƒˆ ë¼ìš´ë“œ ë•ŒëŠ” wordObjectsì— ìƒˆë¡œ spawn (ì›ë³¸ spawnWords ë™ì‘ ì¬í˜„)
  spawnWordsToCanvas(currentTarget,80);

  // 10ì´ˆ íƒ€ì´ë¨¸ (ì›ë³¸ê³¼ ë™ì¼)
  let timeLeft=10;
  timerEl.textContent=timeLeft;
  countdownInterval=setInterval(()=>{
    timeLeft--;
    timerEl.textContent=timeLeft;
    if(timeLeft<=0) clearInterval(countdownInterval);
  },1000);

  roundTimer=setTimeout(()=>{
    document.getElementById('lose-count').textContent=parseInt(document.getElementById('lose-count').textContent)+1;
    addRecordLog(`${currentTarget} ì‹œê°„ ì´ˆê³¼ ì‹¤íŒ¨`);
    startNextRound();
  },10000);
}


// ===== area ë¹ˆê³µê°„ í´ë¦­ í•¸ë“¤ëŸ¬ ìœ ì§€(ì•ˆì „ìš©) =====
area.addEventListener('click',(e)=>{
  if(e.target && e.target.id === 'wordCanvas') return;
  const loseCountEl=document.getElementById('lose-count');
  loseCountEl.textContent=parseInt(loseCountEl.textContent)+1;
  addRecordLog(`ë¹ˆ ê³µê°„ í´ë¦­`);
});

// ===== íŒ ë²„íŠ¼ =====
document.getElementById("btn-tip").addEventListener("click", () => {
  const tipMessageEl = document.getElementById("tip-message");
  tipMessageEl.textContent = "í•‘í¬ìƒ‰ ë‹¨ì–´ë¥¼ ì°¾ì•„ë³´ì„¸ìš”";

  // 3ì´ˆ í›„ ë©”ì‹œì§€ ì‚¬ë¼ì§
  setTimeout(() => {
    tipMessageEl.textContent = "";
  }, 700);
});

// ===== íŒíŠ¸ ë²„íŠ¼ =====
document.getElementById("btn-hint").addEventListener("click", () => {
  const idx = abilities.indexOf(currentTarget);

  // ì´ë¯¸ íšë“í•œ ëŠ¥ë ¥ ì¤‘ë³µ ì²˜ë¦¬ ë°©ì§€
  if (inventoryStatus[idx] === true) return;

  // ì •ë‹µ í•˜ë‚˜ ìë™ íšë“ (addToInventory í˜¸ì¶œ)
  addToInventory(currentTarget);

  // ê¸°ë¡ ë¡œê·¸ì—ë„ ì¶”ê°€
  addRecordLog("íŒíŠ¸ ì‚¬ìš©ìœ¼ë¡œ ìë™ íšë“");

  // ë¼ìš´ë“œ ì¢…ë£Œ â†’ ë‹¤ìŒ ë¼ìš´ë“œ
  clearInterval(countdownInterval);
  setTimeout(() => startNextRound(), 800);
});

const cursorImg = document.getElementById('cursor-img');
document.addEventListener('mousemove', (e) => {
  // ì•ˆì „í•˜ê²Œ cursorImgê°€ ì¡´ì¬í•  ë•Œë§Œ ì ‘ê·¼
  if (cursorImg) {
    cursorImg.style.left = (e.clientX - cursorImg.width/2) + 'px';
    cursorImg.style.top = (e.clientY - cursorImg.height/2) + 'px';
  }
});


// ===== ì‹œì‘ =====
startNextRound();

const bgm = document.getElementById('bgm');
bgm.volume = 0.1;

// ë¸Œë¼ìš°ì € ì •ì±… ëŒ€ì‘: ì²« ì‚¬ìš©ì ì¸í„°ë™ì…˜ ì‹œ ì¬ìƒ
document.addEventListener('click', () => {
  if (bgm.paused) {
    bgm.play();
  }
}, { once: true });


</script>
</body>
</html>
